{% extends "base.html" %}

{% block title %}{{ job.title }} - Ù…Ù†ØµØ© Ø§Ù„ØªÙˆØ¸ÙŠÙ{% endblock %}

{% block content %}
<div class="container">
    <div style="max-width: 800px; margin: 2rem auto;">
        <!-- Ø±Ø£Ø³ Ø§Ù„ÙˆØ¸ÙŠÙØ© -->
        <div style="background: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                <div>
                    <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">{{ job.title }}</h1>
                    <p style="color: #2563eb; font-size: 1.1rem; font-weight: bold;">{{ job.company.company_name }}</p>
                </div>
                <span class="job-status status-{{ job.status.lower() }}">{{ job.status }}</span>
            </div>

            <div class="job-meta" style="margin-bottom: 1.5rem;">
                <div class="meta-item">
                    <span class="meta-icon">ğŸ“</span>
                    <span>{{ job.city }}</span>
                </div>
                <div class="meta-item">
                    <span class="meta-icon">â°</span>
                    <span>
                        {% if job.job_type == 'Full-time' %}
                            Ø¯ÙˆØ§Ù… ÙƒØ§Ù…Ù„
                        {% elif job.job_type == 'Part-time' %}
                            Ø¯ÙˆØ§Ù… Ø¬Ø²Ø¦ÙŠ
                        {% else %}
                            ØªØ¯Ø±ÙŠØ¨
                        {% endif %}
                    </span>
                </div>
                <div class="meta-item">
                    <span class="meta-icon">ğŸ·ï¸</span>
                    <span>{{ job.category_name }}</span>
                </div>
                {% if job.salary %}
                    <div class="meta-item">
                        <span class="meta-icon">ğŸ’°</span>
                        <span>{{ job.salary }}</span>
                    </div>
                {% endif %}
            </div>

            <div style="padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                <p style="color: #6b7280; font-size: 0.9rem;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±: {{ job.posted_at.strftime('%d-%m-%Y') }}</p>
            </div>
        </div>

        <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ¸ÙŠÙØ© -->
        <div style="background: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
            <h2 style="margin-bottom: 1rem; color: #1f2937;">ÙˆØµÙ Ø§Ù„ÙˆØ¸ÙŠÙØ©</h2>
            <p style="line-height: 1.8; color: #4b5563; white-space: pre-wrap;">{{ job.description }}</p>
        </div>

        <!-- Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª -->
        <div style="background: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
            <h2 style="margin-bottom: 1rem; color: #1f2937;">Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª</h2>
            <p style="line-height: 1.8; color: #4b5563; white-space: pre-wrap;">{{ job.requirements }}</p>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© -->
        <div style="background: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
            <h2 style="margin-bottom: 1rem; color: #1f2937;">Ø¹Ù† Ø§Ù„Ø´Ø±ÙƒØ©</h2>
            <p style="font-weight: bold; margin-bottom: 0.5rem;">{{ job.company.company_name }}</p>
            <p style="color: #6b7280; margin-bottom: 1rem;">{{ job.company.description or 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©' }}</p>
            <p style="color: #6b7280;">ğŸ“ {{ job.company.city }} | ğŸ“ {{ job.company.phone }}</p>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… -->
        {% if session.get('user_type') == 'seeker' %}
            <div style="background: white; padding: 2rem; border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h2 style="margin-bottom: 1rem; color: #1f2937;">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨</h2>
                
                <form id="application-form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="cover-letter">Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… *</label>
                        <textarea id="cover-letter" name="cover_letter" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ..." required style="min-height: 150px;"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="cv-file">Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ© (PDF, DOC, DOCX) *</label>
                        <input type="file" id="cv-file" name="cv_file" accept=".pdf,.doc,.docx" required>
                        <small style="color: #6b7280; display: block; margin-top: 0.5rem;">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ù„Ù: 16 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</small>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%;">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨</button>
                </form>
            </div>

            <script>
            document.getElementById('application-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                
                fetch('{{ url_for("apply_job", job_id=job.job_id) }}', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showAlert('ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        setTimeout(() => {
                            window.location.href = '{{ url_for("seeker_dashboard") }}';
                        }, 2000);
                    } else {
                        showAlert(data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…', 'error');
                    }
                })
                .catch(error => {
                    console.error('Ø®Ø·Ø£:', error);
                    showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
                });
            });
            </script>
        {% elif not session.get('user_type') %}
            <div class="alert alert-info">
                <p style="margin-bottom: 0.5rem;"><strong>Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ©ØŸ</strong></p>
                <p>ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ <a href="{{ url_for('login') }}" style="color: #0c4a6e; text-decoration: underline;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a> Ø£Ùˆ <a href="{{ url_for('register') }}" style="color: #0c4a6e; text-decoration: underline;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</a> Ø£ÙˆÙ„Ø§Ù‹.</p>
            </div>
        {% elif session.get('user_type') != 'seeker' %}
            <div class="alert alert-warning">
                <p>ÙŠÙ…ÙƒÙ† ÙÙ‚Ø· Ø§Ù„Ø¨Ø§Ø­Ø«ÙŠÙ† Ø¹Ù† Ø¹Ù…Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù.</p>
            </div>
        {% endif %}

        <!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© -->
        <div style="margin-top: 2rem;">
            <a href="{{ url_for('index') }}" class="btn btn-secondary">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ¸Ø§Ø¦Ù</a>
        </div>
    </div>
</div>
{% endblock %}
